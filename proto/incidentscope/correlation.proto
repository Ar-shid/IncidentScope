syntax = "proto3";
package incidentscope;

option csharp_namespace = "IncidentScope.Contracts";

// Correlation engine service
service CorrelationEngine {
  rpc CorrelateIncident (CorrelateIncidentRequest) returns (CorrelateIncidentResponse);
  rpc GetSuspects (GetSuspectsRequest) returns (GetSuspectsResponse);
  rpc GetEvidence (GetEvidenceRequest) returns (GetEvidenceResponse);
}

message CorrelateIncidentRequest {
  string tenant_id = 1;
  string incident_id = 2;
  string env_id = 3;
  int64 detected_at_unix_ms = 4;
}

message CorrelateIncidentResponse {
  repeated Hypothesis hypotheses = 1;
  repeated string suspect_service_ids = 2;
}

message GetSuspectsRequest {
  string tenant_id = 1;
  string incident_id = 2;
}

message GetSuspectsResponse {
  repeated SuspectService suspects = 1;
}

message SuspectService {
  string service_id = 1;
  string service_name = 2;
  double error_rate_delta = 3;
  double latency_p95_delta = 4;
  double confidence = 5;
}

message GetEvidenceRequest {
  string tenant_id = 1;
  string incident_id = 2;
  string hypothesis_id = 3;
}

message GetEvidenceResponse {
  repeated EvidenceRef evidence = 1;
}

message Hypothesis {
  string id = 1;
  int32 rank = 2;
  string type = 3;
  string summary = 4;
  double confidence = 5;
  repeated EvidenceRef evidence = 6;
}

message EvidenceRef {
  string kind = 1;   // metric/log/span/deploy
  string pointer = 2; // query template id, trace id, deploy id
  string description = 3;
}

