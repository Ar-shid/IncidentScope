syntax = "proto3";
package incidentscope;

option csharp_namespace = "IncidentScope.Contracts";

// Incident service
service IncidentService {
  rpc CreateIncident (CreateIncidentRequest) returns (Incident);
  rpc GetIncident (GetIncidentRequest) returns (Incident);
  rpc ListIncidents (ListIncidentsRequest) returns (ListIncidentsResponse);
  rpc UpdateIncidentStatus (UpdateIncidentStatusRequest) returns (Incident);
  rpc ResolveIncident (ResolveIncidentRequest) returns (Incident);
}

message CreateIncidentRequest {
  string tenant_id = 1;
  string env_id = 2;
  string primary_service_id = 3;
  int32 severity = 4;
  string title = 5;
  int64 detected_at_unix_ms = 6;
  string created_by = 7;
  map<string, string> labels = 8;
}

message GetIncidentRequest {
  string tenant_id = 1;
  string incident_id = 2;
}

message ListIncidentsRequest {
  string tenant_id = 1;
  string env_id = 2;
  string service_id = 3;
  string status = 4;
  int32 severity = 5;
  int64 from_unix_ms = 6;
  int64 to_unix_ms = 7;
  int32 page_size = 8;
  string page_token = 9;
}

message ListIncidentsResponse {
  repeated Incident incidents = 1;
  string next_page_token = 2;
}

message UpdateIncidentStatusRequest {
  string tenant_id = 1;
  string incident_id = 2;
  string status = 3;
  string assignee = 4;
}

message ResolveIncidentRequest {
  string tenant_id = 1;
  string incident_id = 2;
  string resolved_by = 3;
}

message Incident {
  string id = 1;
  string tenant_id = 2;
  string env_id = 3;
  string primary_service_id = 4;
  int32 severity = 5;
  string status = 6;
  string title = 7;
  int64 created_at_unix_ms = 8;
  int64 detected_at_unix_ms = 9;
  int64 resolved_at_unix_ms = 10;
  string created_by = 11;
  string assignee = 12;
  map<string, string> labels = 13;
}

